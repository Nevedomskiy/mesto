(()=>{"use strict";class t{constructor(t,e){this._form=e,this._inputSelector=t.inputSelector,this._errorClass=t.errorClass,this._buttonSubmit=this._form.querySelector(t.buttonSubmitSelector),this._buttonSubmitDisabledClass=t.buttonSubmitDisabledClass,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}enableValidation(){this._addInputListeners(),this._form.addEventListener("input",(()=>{this.toggleButton()})),this.toggleButton()}_addInputListeners(){this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._handleFormInput(t)}))}))}checkValidation(){this._inputList.forEach((t=>{this._setParametersInput(t),t.classList.remove(this._errorClass),this._spanError.textContent=""}))}_setParametersInput(t){this._inputElement=t,this._inputElementId=this._inputElement.id,this._spanError=this._form.querySelector(`#${this._inputElementId}-error`)}_handleFormInput(t){this._setParametersInput(t),this._inputElement.validity.valid?(this._inputElement.classList.remove(this._errorClass),this._spanError.textContent=""):(this._inputElement.classList.add(this._errorClass),this._spanError.textContent=this._inputElement.validationMessage)}toggleButton(){this._isFormValid=this._form.checkValidity(),this._buttonSubmit.disabled=!this._isFormValid,this._buttonSubmit.classList.toggle(this._buttonSubmitDisabledClass,!this._isFormValid)}}class e{constructor(t,e,o,s,i,n,{render:r}){this._cardData=t,this._photoTemplate=e,this._handleImageClick=s,this._like=i,this._dislike=n,this._userId=o,this._handleButtonDelete=r}createCard(){return this._photoElement=this._photoTemplate.querySelector(".photo__element"),this._photoElementClone=this._photoElement.cloneNode(!0),this._cardPhoto=this._photoElementClone.querySelector(".photo__img"),this._cardPhoto.src=this._cardData.link,this._cardPhoto.alt=this._cardData.name,this._cardTitle=this._photoElementClone.querySelector(".photo__title"),this._cardTitle.textContent=this._cardData.name,this._photoDelete=this._photoElementClone.querySelector(".photo__delete"),this._userId!==this._cardData.owner._id&&this._photoDelete.classList.add("photo__delete_hidden"),this._photoLike=this._photoElementClone.querySelector(".photo__like"),this._cardData.likes.find((t=>t._id==this._userId))&&this.editClassLike(),this._photoLikeCounter=this._photoElementClone.querySelector(".photo__like-counter"),this.handleLikeCounter(this._cardData.likes.length),this._setEventListeners(),this._photoElementClone}_setEventListeners(){this._cardPhoto.addEventListener("click",this._handleImageClick),this._photoDelete.addEventListener("click",(()=>{this._handleButtonDelete()})),this._photoLike.addEventListener("click",(()=>{this._handleLikeClick()}))}deleteCard(){this._photoElementClone.remove()}editClassLike(){this._photoLike.classList.toggle("photo__like_active")}handleLikeCounter(t){this._photoLikeCounter.textContent=t}_handleLikeClick(){this._photoLike.classList.contains("photo__like_active")?this._dislike():this._like()}}const o=document.querySelector(".popup_type_profile"),s=document.querySelector(".profile__button-edit"),i=document.querySelector(".popup__input_type_name-profile"),n=document.querySelector(".popup__input_type_profession-profile"),r=document.querySelector(".profile__name"),a=document.querySelector(".profile__subname"),h=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__button-add"),p=document.querySelector(".popup_type_place"),u=document.querySelector(".popup_type_photo"),_=(document.querySelector(".popup__img"),document.querySelector(".popup__name"),document.querySelector(".popup__form_type_place")),c=document.querySelector(".popup__form_type_profile"),d=document.querySelector("#photo-template").content,m=document.querySelector(".photo__container"),b=document.querySelector(".popup_type_avatar"),y=document.querySelector(".profile__avatar-edit"),f=document.querySelector(".popup__form_type_avatar"),L=document.querySelector(".popup_type_confirmation"),E=(document.querySelector(".popup__submit-btn_action_add-place"),document.querySelector(".popup__submit-btn_action_add-profile"),document.querySelector(".popup__submit-btn_action_edit-avatar"),{formSelector:".popup__form",inputSelector:".popup__input",errorClass:"form__input_error",buttonSubmitSelector:".popup__submit-btn",buttonSubmitDisabledClass:"popup__submit-btn_disabled"});class S{constructor(t){this._popup=t,this._btnClose=this._popup.querySelector(".btn-close")}open(){this._popup.classList.add("popup_active"),this._setEscEventListener()}close(){this._popup.classList.remove("popup_active"),this._removeEscEventListener()}_setEscEventListener(){document.addEventListener("keydown",this._handleCloseByEsc)}_removeEscEventListener(){document.removeEventListener("keydown",this._handleCloseByEsc)}setEventListeners(){this._popup.addEventListener("mousedown",this._handleCloseByOverlay),this._btnClose.addEventListener("click",(()=>{this.close()}))}_handleCloseByOverlay=t=>{t.target===t.currentTarget&&this.close()};_handleCloseByEsc=t=>{"Escape"===t.key&&this.close()}}class v extends S{constructor(t,{submitForm:e}){super(t),this._popupForm=this._popup.querySelector(".popup__form"),this._submitForm=e,this._inputList=this._popupForm.querySelectorAll(".popup__input"),this._btnSubmit=this._popup.querySelector(".popup__submit-btn")}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._handleSubmit)}_getInputValues(){return this._inputsData={},this._inputList.forEach((t=>{this._inputsData[t.name]=t.value})),this._inputsData}_handleSubmit=t=>{t.preventDefault(),this._submitForm(this._getInputValues())};close(){super.close(),this._popupForm.reset()}setSubmitButtonText(t){this._btnSubmit.textContent=`${t}`}}const C={},k=new class{constructor(t){this._url=t.url,this._authorization=t.headers.authorization}_getResponseData(t){return t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`)}getDataCards(){return fetch(`${this._url}cards`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}getDataProfile(){return fetch(`${this._url}users/me`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}patchDataProfile(t){return fetch(`${this._url}users/me`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,about:t.about})}).then((t=>this._getResponseData(t)))}patchAvatarProfile(t){return fetch(`${this._url}users/me/avatar`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({avatar:t.avatar})}).then((t=>this._getResponseData(t)))}postNewCard(t){return fetch(`${this._url}cards`,{method:"POST",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,link:t.link})}).then((t=>this._getResponseData(t)))}deleteCard(t){return fetch(`${this._url}cards/${t}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}addLikes(t){return fetch(`${this._url}cards/${t}/likes`,{method:"PUT",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}deleteLikes(t){return fetch(`${this._url}cards/${t}/likes/`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}}({url:"https://mesto.nomoreparties.co/v1/cohort-62/",headers:{authorization:"b1a969d4-2380-4487-99eb-f12d66954c40"}}),g=new class{constructor(t,e,o,s){this._nameProfile=t,this._subNameProfile=e,this._profileAvatar=o,this._userDataServer=s}getUserInfo(){return this._dataList={},this._dataList.name=this._nameProfile.textContent,this._dataList.about=this._subNameProfile.textContent,this._dataList.avatar=this._profileAvatar.src,this._dataList}setUserInfo(t){this._userDataServer.data=t,this._nameProfile.textContent=t.name,this._subNameProfile.textContent=t.about,this._profileAvatar.src=t.avatar}}(r,a,h,C),D=g.getUserInfo(),q=new class extends S{constructor(t){super(t),this._popupForm=this._popup.querySelector(".popup__form")}setCallback(t){this._callback=t}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(t=>{t.preventDefault(),this._callback()}))}}(L);q.setEventListeners();const I=new class{constructor({renderer:t},e){this._renderer=t,this._container=e}addItem(t){this._container.append(t)}renderItems(t){this._renderedItems=t,this._renderedItems.forEach((t=>this._renderer(t)))}}({renderer:t=>{P(t)}},m);function P(t){I.addItem(function(t){const o=new e(t,d,C.data._id,(()=>{z.open(t)}),(()=>{k.addLikes(t._id).then((t=>{o.editClassLike(),o.handleLikeCounter(t.likes.length)})).catch((t=>{console.log(t)}))}),(()=>{k.deleteLikes(t._id).then((t=>{o.editClassLike(),o.handleLikeCounter(t.likes.length)})).catch((t=>{console.log(t)}))}),{render:()=>{q.open(),q.setCallback((()=>{k.deleteCard(t._id).then((()=>{o.deleteCard(),q.close()})).catch((t=>{console.log(t)}))}))}});return o}(t).createCard())}Promise.all([k.getDataProfile(),k.getDataCards()]).then((t=>{g.setUserInfo(t[0]),I.renderItems(t[1])})).catch((t=>{console.log(t)}));const x=new t(E,_);x.enableValidation();const B=new t(E,c);B.enableValidation();const T=new t(E,f);T.enableValidation();const z=new class extends S{constructor(t){super(t),this._popupPhotoImg=this._popup.querySelector(".popup__img"),this._popupPhotoName=this._popup.querySelector(".popup__name")}open(t){super.open(),this._popupPhotoImg.src=t.link,this._popupPhotoName.alt=t.name,this._popupPhotoName.textContent=t.name}}(u);z.setEventListeners();const w=new v(o,{submitForm:t=>{w.setSubmitButtonText("Сохранение..."),k.patchDataProfile(t).then((t=>{g.setUserInfo(t),w.close()})).catch((t=>{console.log(t)})).finally((()=>{w.setSubmitButtonText("Сохранить")}))}});w.setEventListeners();const F=new v(b,{submitForm:t=>{F.setSubmitButtonText("Сохранение..."),k.patchAvatarProfile(t).then((t=>{g.setUserInfo(t),F.close()})).catch((t=>{console.log(t)})).finally((()=>{F.setSubmitButtonText("Сохранить")}))}});F.setEventListeners();const V=new v(p,{submitForm:t=>{V.setSubmitButtonText("Сохранение..."),k.postNewCard(t).then((t=>{P(t),V.close()})).catch((t=>{console.log(t)})).finally((()=>{V.setSubmitButtonText("Сохранить")}))}});V.setEventListeners(),y.addEventListener("click",(()=>{F.open(),T.toggleButton(),T.checkValidation()})),s.addEventListener("click",(()=>{i.value=D.name,n.value=D.about,w.open(),B.toggleButton(),B.checkValidation()})),l.addEventListener("click",(()=>{V.open(),x.toggleButton(),x.checkValidation()}))})();