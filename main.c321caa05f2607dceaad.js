(()=>{"use strict";class t{constructor(t,e){this._form=e,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._errorClass=t.errorClass,this._buttonSubmit=this._form.querySelector(t.buttonSubmitSelector),this._buttonSubmitDisabledClass=t.buttonSubmitDisabledClass,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}_disableSubmit(t){t.preventDefault()}enabledValidationForm(){this._addInputListners(),this._form.addEventListener("submit",this._disableSubmit),this._form.addEventListener("input",(()=>{this.toggleButton()})),this.toggleButton()}_addInputListners(){this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._handleFormInput(t)}))}))}checkValidation(){this._inputList.forEach((t=>{this._setParametersInput(t),t.classList.remove(this._errorClass),this._spanError.textContent=""}))}_setParametersInput(t){this._inputElement=t,this._inputElementId=this._inputElement.id,this._spanError=this._form.querySelector(`#${this._inputElementId}-error`)}_handleFormInput(t){this._setParametersInput(t),this._inputElement.validity.valid?(this._inputElement.classList.remove(this._errorClass),this._spanError.textContent=""):(this._inputElement.classList.add(this._errorClass),this._spanError.textContent=this._inputElement.validationMessage)}toggleButton(){this._isFormValid=this._form.checkValidity(),this._buttonSubmit.disabled=!this._isFormValid,this._buttonSubmit.classList.toggle(this._buttonSubmitDisabledClass,!this._isFormValid)}}class e{constructor(t,e,o,s,i){this._cardData=t,this._photoTemplate=e,this._handleOpenPopupPhoto=o,this._popupRemoveCard=i,this._api=s}createCard(t){return this._userData=t,this._photoElement=this._photoTemplate.querySelector(".photo__element"),this._photoElementClone=this._photoElement.cloneNode(!0),this._cardPhoto=this._photoElementClone.querySelector(".photo__img"),this._cardPhoto.src=this._cardData.link,this._cardPhoto.alt=this._cardData.name,this._cardTitle=this._photoElementClone.querySelector(".photo__title"),this._cardTitle.textContent=this._cardData.name,this._photoDelete=this._photoElementClone.querySelector(".photo__delete"),this._userData.data._id===this._cardData.owner._id?this._photoDelete.classList.remove("photo__delete_hidden"):this._photoDelete.classList.add("photo__delete_hidden"),this._photoLike=this._photoElementClone.querySelector(".photo__like"),this._cardData.likes.find((e=>e._id==t.data._id))?this._photoLike.classList.add("photo__like_active"):this._photoLike.classList.remove("photo__like_active"),this._photoLikeCounter=this._photoElementClone.querySelector(".photo__like-counter"),this._photoLikeCounter.textContent=this._cardData.likes.length,this._addInputListners(),this._photoElementClone}_addInputListners(){this._cardPhoto.addEventListener("click",this._handleOpenPopupPhoto),this._photoDelete.addEventListener("click",(()=>{this._popupRemoveCard.open(),this._popupRemoveCard.setEventLesteners(this._cardData,this._photoElementClone)})),this._photoLike.addEventListener("click",(()=>{this._cardLike(this._userData)}))}_cardLike(t){this._photoLike.classList.toggle("photo__like_active"),this._photoLike.classList.contains("photo__like_active")?this._api.addLikes(this._cardData,t).then((t=>{this._photoLikeCounter.textContent=t.likes.length})):this._api.deleteLikes(this._cardData,t).then((t=>{this._photoLikeCounter.textContent=t.likes.length}))}}const o=document.querySelector(".popup_type_profile"),s=document.querySelector(".profile__button-edit"),i=document.querySelector(".popup__input_type_name-profile"),r=document.querySelector(".popup__input_type_profession-profile"),n=document.querySelector(".profile__name"),a=document.querySelector(".profile__subname"),h=document.querySelector(".profile__avatar"),p=document.querySelector(".profile__button-add"),_=document.querySelector(".popup_type_place"),u=document.querySelector(".popup_type_photo"),l=(document.querySelector(".popup__img"),document.querySelector(".popup__name"),document.querySelector(".popup__form_type_place")),c=document.querySelector(".popup__form_type_profile"),d=document.querySelector("#photo-template").content,m=document.querySelector(".photo__container"),f=document.querySelector(".popup_type_avatar"),y=document.querySelector(".profile__avatar-edit"),v=document.querySelector(".popup__form_type_avatar"),E=(document.querySelector(".photo__like-counter"),document.querySelector(".popup_type_confirmation")),L={formSelector:".popup__form",inputSelector:".popup__input",errorClass:"form__input_error",buttonSubmitSelector:".popup__submit-btn",buttonSubmitDisabledClass:"popup__submit-btn_disabled"};class b{constructor(t){this._popup=t,this._btnClose=this._popup.querySelector(".btn-close")}open(){this._popup.classList.add("popup_active"),this._handleEscClose()}close(){this._popup.classList.remove("popup_active"),this._removeEscClose()}_handleEscClose(){document.addEventListener("keydown",this._handlePopupCloseEsc)}_removeEscClose(){document.removeEventListener("keydown",this._handlePopupCloseEsc)}setEventLesteners(){this._popup.addEventListener("mousedown",this._listenerClickOverley),this._btnClose.addEventListener("click",(()=>{this.close()}))}_listenerClickOverley=t=>{t.target===t.currentTarget&&this.close()};_handlePopupCloseEsc=t=>{"Escape"===t.key&&this.close()}}class S extends b{constructor(t,{submitForm:e}){super(t),this._popupForm=this._popup.querySelector(".popup__form"),this._submitForm=e,this._inputList=this._popupForm.querySelectorAll(".popup__input")}setEventLesteners(){super.setEventLesteners(),this._popupForm.addEventListener("submit",this._eventSubmit)}_getInputValues(){return this._inputsData={},this._inputList.forEach((t=>{this._inputsData[t.name]=t.value})),this._inputsData}_eventSubmit=t=>{t.preventDefault(),this._submitForm(this._getInputValues()),this.close()};close(){super.close(),this._popupForm.reset()}}const C={},k=new class{constructor(t){this._url=t.url,this._authorization=t.headers.authorization}getDataCards(){return fetch(`${this._url}cards`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}getDataProfile(){return fetch(`${this._url}users/me`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}patchDataProfile(t){return fetch(`${this._url}users/me`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,about:t.about})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}patchAvatarProfile(t){return fetch(`${this._url}users/me/avatar`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({avatar:t.avatar})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}postNewCard(t){return fetch(`${this._url}cards`,{method:"POST",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,link:t.link})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}deleteCard(t){return fetch(`${this._url}cards/${t._id}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}addLikes(t,e){return fetch(`${this._url}cards/${t._id}/likes`,{method:"PUT",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({data:e.data})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}deleteLikes(t,e){return fetch(`${this._url}cards/${t._id}/likes/`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({data:e.data})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>alert(t)))}}({url:"https://mesto.nomoreparties.co/v1/cohort-62/",headers:{authorization:"b1a969d4-2380-4487-99eb-f12d66954c40"}});k.getDataCards().then((t=>{P.renderItems(t)}));const P=new class{constructor({renderer:t},e){this._renderer=t,this._container=e}addItemStart(t){this._container.append(t)}addItemEnd(t){this._container.prepend(t)}renderItems(t){this._renderedItems=t,this._renderedItems.forEach((t=>this._renderer(t)))}}({renderer:t=>{D(t)}},m),g=new class extends b{constructor(t,e){super(t),this._popupForm=this._popup.querySelector(".popup__form"),this._api=e,this._inputList=this._popupForm.querySelectorAll(".popup__input")}setEventLesteners(t,e){this._cardData=t,this._element=e,super.setEventLesteners(),this._popupForm.addEventListener("submit",(t=>{this.removeCard(t)}))}removeCard(t){t.preventDefault(),this._api.deleteCard(this._cardData).then((()=>{this._element.remove()})),this.close()}close(){super.close(),this._popupForm.reset()}}(E,k);function D(t){console.log(t);const o=new e(t,d,(()=>{F.open(t)}),k,g);P.addItemEnd(o.createCard(C))}g.setEventLesteners(),k.getDataProfile().then((t=>{$.setUserInfo(t)}));const q=new t(L,l);q.enabledValidationForm();const I=new t(L,c);I.enabledValidationForm();const j=new t(L,v);j.enabledValidationForm();const F=new class extends b{constructor(t){super(t),this._popupPhotoImg=this._popup.querySelector(".popup__img"),this._popupPhotoName=this._popup.querySelector(".popup__name")}open(t){super.open(),this._popupPhotoImg.src=t.link,this._popupPhotoName.alt=t.name,this._popupPhotoName.textContent=t.name}}(u);F.setEventLesteners();const $=new class{constructor(t,e,o,s){this._nameProfile=t,this._subNameProfile=e,this._profileAvatar=o,this._userData=s}getUserInfo(){return this._dataList={},this._dataList.name=this._nameProfile.textContent,this._dataList.about=this._subNameProfile.textContent,this._dataList}setUserInfo(t){this._userData.data=t,this._nameProfile.textContent=t.name,this._subNameProfile.textContent=t.about,this._profileAvatar.src=t.avatar}}(n,a,h,C),z=new S(o,{submitForm:t=>{k.patchDataProfile(t).then((t=>{$.setUserInfo(t)}))}});z.setEventLesteners();const w=new S(f,{submitForm:t=>{k.patchAvatarProfile(t).then((t=>{$.setUserInfo(t)}))}});w.setEventLesteners();const x=new S(_,{submitForm:t=>{k.postNewCard(t).then((t=>{D(t)}))}});x.setEventLesteners(),y.addEventListener("click",(()=>{w.open(),j.toggleButton(),j.checkValidation()})),s.addEventListener("click",(()=>{i.value=$.getUserInfo().name,r.value=$.getUserInfo().about,z.open(),I.toggleButton(),I.checkValidation()})),p.addEventListener("click",(()=>{x.open(),q.toggleButton(),q.checkValidation()}))})();