(()=>{"use strict";class t{constructor(t,e){this._form=e,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._errorClass=t.errorClass,this._buttonSubmit=this._form.querySelector(t.buttonSubmitSelector),this._buttonSubmitDisabledClass=t.buttonSubmitDisabledClass,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}_disableSubmit(t){t.preventDefault()}enabledValidationForm(){this._addInputListners(),this._form.addEventListener("submit",this._disableSubmit),this._form.addEventListener("input",(()=>{this.toggleButton()})),this.toggleButton()}_addInputListners(){this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._handleFormInput(t)}))}))}checkValidation(){this._inputList.forEach((t=>{this._setParametersInput(t),t.classList.remove(this._errorClass),this._spanError.textContent=""}))}_setParametersInput(t){this._inputElement=t,this._inputElementId=this._inputElement.id,this._spanError=this._form.querySelector(`#${this._inputElementId}-error`)}_handleFormInput(t){this._setParametersInput(t),this._inputElement.validity.valid?(this._inputElement.classList.remove(this._errorClass),this._spanError.textContent=""):(this._inputElement.classList.add(this._errorClass),this._spanError.textContent=this._inputElement.validationMessage)}toggleButton(){this._isFormValid=this._form.checkValidity(),this._buttonSubmit.disabled=!this._isFormValid,this._buttonSubmit.classList.toggle(this._buttonSubmitDisabledClass,!this._isFormValid)}}class e{constructor(t,e,o,s,i){this._cardData=t,this._photoTemplate=e,this._handleOpenPopupPhoto=o,this._popupRemoveCard=i,this._api=s}createCard(t){return this._userData=t,this._photoElement=this._photoTemplate.querySelector(".photo__element"),this._photoElementClone=this._photoElement.cloneNode(!0),this._cardPhoto=this._photoElementClone.querySelector(".photo__img"),this._cardPhoto.src=this._cardData.link,this._cardPhoto.alt=this._cardData.name,this._cardTitle=this._photoElementClone.querySelector(".photo__title"),this._cardTitle.textContent=this._cardData.name,this._photoDelete=this._photoElementClone.querySelector(".photo__delete"),this._userData.data._id===this._cardData.owner._id?this._photoDelete.classList.remove("photo__delete_hidden"):this._photoDelete.classList.add("photo__delete_hidden"),this._photoLike=this._photoElementClone.querySelector(".photo__like"),this._cardData.likes.find((e=>e._id==t.data._id))?this._photoLike.classList.add("photo__like_active"):this._photoLike.classList.remove("photo__like_active"),this._photoLikeCounter=this._photoElementClone.querySelector(".photo__like-counter"),this._photoLikeCounter.textContent=this._cardData.likes.length,this._addInputListners(),this._photoElementClone}_addInputListners(){this._cardPhoto.addEventListener("click",this._handleOpenPopupPhoto),this._photoDelete.addEventListener("click",(()=>{this._popupRemoveCard.open(),this._popupRemoveCard.setEventLesteners(this._cardData,this._photoElementClone)})),this._photoLike.addEventListener("click",(()=>{this._cardLike(this._userData)}))}_cardLike(t){this._photoLike.classList.toggle("photo__like_active"),this._photoLike.classList.contains("photo__like_active")?this._api.addLikes(this._cardData,t).then((t=>{this._photoLikeCounter.textContent=t.likes.length})):this._api.deleteLikes(this._cardData,t).then((t=>{this._photoLikeCounter.textContent=t.likes.length}))}}const o=document.querySelector(".popup_type_profile"),s=document.querySelector(".profile__button-edit"),i=document.querySelector(".popup__input_type_name-profile"),n=document.querySelector(".popup__input_type_profession-profile"),r=document.querySelector(".profile__name"),a=document.querySelector(".profile__subname"),h=document.querySelector(".profile__avatar"),p=document.querySelector(".profile__button-add"),u=document.querySelector(".popup_type_place"),l=document.querySelector(".popup_type_photo"),_=(document.querySelector(".popup__img"),document.querySelector(".popup__name"),document.querySelector(".popup__form_type_place")),c=document.querySelector(".popup__form_type_profile"),d=document.querySelector("#photo-template").content,m=document.querySelector(".photo__container"),y=document.querySelector(".popup_type_avatar"),f=document.querySelector(".profile__avatar-edit"),b=document.querySelector(".popup__form_type_avatar"),v=document.querySelector(".popup_type_confirmation"),L=document.querySelector(".popup__submit-btn_action_add-place"),E=document.querySelector(".popup__submit-btn_action_add-profile"),S=document.querySelector(".popup__submit-btn_action_edit-avatar"),C={formSelector:".popup__form",inputSelector:".popup__input",errorClass:"form__input_error",buttonSubmitSelector:".popup__submit-btn",buttonSubmitDisabledClass:"popup__submit-btn_disabled"};class k{constructor(t){this._popup=t,this._btnClose=this._popup.querySelector(".btn-close")}open(){this._popup.classList.add("popup_active"),this._handleEscClose()}close(){this._popup.classList.remove("popup_active"),this._removeEscClose()}_handleEscClose(){document.addEventListener("keydown",this._handlePopupCloseEsc)}_removeEscClose(){document.removeEventListener("keydown",this._handlePopupCloseEsc)}setEventLesteners(){this._popup.addEventListener("mousedown",this._listenerClickOverley),this._btnClose.addEventListener("click",(()=>{this.close()}))}_listenerClickOverley=t=>{t.target===t.currentTarget&&this.close()};_handlePopupCloseEsc=t=>{"Escape"===t.key&&this.close()}}class g extends k{constructor(t,{submitForm:e}){super(t),this._popupForm=this._popup.querySelector(".popup__form"),this._submitForm=e,this._inputList=this._popupForm.querySelectorAll(".popup__input")}setEventLesteners(){super.setEventLesteners(),this._popupForm.addEventListener("submit",this._eventSubmit)}_getInputValues(){return this._inputsData={},this._inputList.forEach((t=>{this._inputsData[t.name]=t.value})),this._inputsData}_eventSubmit=t=>{t.preventDefault(),this._submitForm(this._getInputValues()),this.close()};close(){super.close(),this._popupForm.reset()}}class P{constructor(t){this._btn=t,this._nextButton=this._btn.nextElementSibling}hiddenButton(){this._btn.style.display="none",this._nextButton.style.display="block"}unhiddenButton(){this._btn.style.display="block",this._nextButton.style.display="none"}}const q=new P(E),D=new P(L),I=new P(S),B={},j=new class{constructor(t){this._url=t.url,this._authorization=t.headers.authorization}getDataCards(){return fetch(`${this._url}cards`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)}))}getDataProfile(){return fetch(`${this._url}users/me`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)}))}patchDataProfile(t,e){return this._reloudButtonProfile=e,this._reloudButtonProfile.hiddenButton(),fetch(`${this._url}users/me`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,about:t.about})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)})).finally((()=>{this._reloudButtonProfile.unhiddenButton()}))}patchAvatarProfile(t,e){return this._reloudButtonAvatar=e,this._reloudButtonAvatar.hiddenButton(),fetch(`${this._url}users/me/avatar`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({avatar:t.avatar})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)})).finally((()=>{this._reloudButtonAvatar.unhiddenButton()}))}postNewCard(t,e){return this._reloudButtonPlace=e,this._reloudButtonPlace.hiddenButton(),fetch(`${this._url}cards`,{method:"POST",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,link:t.link})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)})).finally((()=>{this._reloudButtonPlace.unhiddenButton()}))}deleteCard(t){return fetch(`${this._url}cards/${t._id}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)}))}addLikes(t,e){return fetch(`${this._url}cards/${t._id}/likes`,{method:"PUT",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({data:e.data})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)}))}deleteLikes(t,e){return fetch(`${this._url}cards/${t._id}/likes/`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({data:e.data})}).then((t=>t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`))).catch((t=>{console.log(t)}))}}({url:"https://mesto.nomoreparties.co/v1/cohort-62/",headers:{authorization:"b1a969d4-2380-4487-99eb-f12d66954c40"}});function F(){j.getDataCards().then((t=>{m.innerHTML="",w.renderItems(t)}))}F();const w=new class{constructor({renderer:t},e){this._renderer=t,this._container=e}addItem(t){this._container.append(t)}renderItems(t){this._renderedItems=t,this._renderedItems.forEach((t=>this._renderer(t)))}}({renderer:t=>{!function(t){const o=new e(t,d,(()=>{N.open(t)}),j,$);w.addItem(o.createCard(B))}(t)}},m),$=new class extends k{constructor(t,e,o){super(t),this._clearAndRenderCards=o,this._popupForm=this._popup.querySelector(".popup__form"),this._api=e,this._inputList=this._popupForm.querySelectorAll(".popup__input")}setEventLesteners(t,e){this._cardData=t,this._element=e,super.setEventLesteners(),this._popupForm.addEventListener("submit",(t=>{this.removeCard(t)}))}removeCard(t){t.preventDefault(),this._api.deleteCard(this._cardData).then((()=>{this._element.remove()})),this._clearAndRenderCards(),this.close()}close(){super.close(),this._popupForm.reset()}}(v,j,F);$.setEventLesteners(),j.getDataProfile().then((t=>{T.setUserInfo(t)}));const x=new t(C,_);x.enabledValidationForm();const z=new t(C,c);z.enabledValidationForm();const A=new t(C,b);A.enabledValidationForm();const N=new class extends k{constructor(t){super(t),this._popupPhotoImg=this._popup.querySelector(".popup__img"),this._popupPhotoName=this._popup.querySelector(".popup__name")}open(t){super.open(),this._popupPhotoImg.src=t.link,this._popupPhotoName.alt=t.name,this._popupPhotoName.textContent=t.name}}(l);N.setEventLesteners();const T=new class{constructor(t,e,o,s){this._nameProfile=t,this._subNameProfile=e,this._profileAvatar=o,this._userData=s}getUserInfo(){return this._dataList={},this._dataList.name=this._nameProfile.textContent,this._dataList.about=this._subNameProfile.textContent,this._dataList}setUserInfo(t){this._userData.data=t,this._nameProfile.textContent=t.name,this._subNameProfile.textContent=t.about,this._profileAvatar.src=t.avatar}}(r,a,h,B),V=new g(o,{submitForm:t=>{j.patchDataProfile(t,q).then((t=>{T.setUserInfo(t)}))}});V.setEventLesteners();const O=new g(y,{submitForm:t=>{j.patchAvatarProfile(t,I).then((t=>{T.setUserInfo(t)}))}});O.setEventLesteners();const U=new g(u,{submitForm:t=>{j.postNewCard(t,D).then((()=>{F()}))}});U.setEventLesteners(),f.addEventListener("click",(()=>{O.open(),A.toggleButton(),A.checkValidation()})),s.addEventListener("click",(()=>{i.value=T.getUserInfo().name,n.value=T.getUserInfo().about,V.open(),z.toggleButton(),z.checkValidation()})),p.addEventListener("click",(()=>{U.open(),x.toggleButton(),x.checkValidation()}))})();