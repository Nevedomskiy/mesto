(()=>{"use strict";class t{constructor(t,e){this._form=e,this._inputSelector=t.inputSelector,this._errorClass=t.errorClass,this._buttonSubmit=this._form.querySelector(t.buttonSubmitSelector),this._buttonSubmitDisabledClass=t.buttonSubmitDisabledClass,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}enableValidation(){this._addInputListeners(),this._form.addEventListener("input",(()=>{this.toggleButton()})),this.toggleButton()}_addInputListeners(){this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._handleFormInput(t)}))}))}checkValidation(){this._inputList.forEach((t=>{this._setParametersInput(t),t.classList.remove(this._errorClass),this._spanError.textContent=""}))}_setParametersInput(t){this._inputElement=t,this._inputElementId=this._inputElement.id,this._spanError=this._form.querySelector(`#${this._inputElementId}-error`)}_handleFormInput(t){this._setParametersInput(t),this._inputElement.validity.valid?(this._inputElement.classList.remove(this._errorClass),this._spanError.textContent=""):(this._inputElement.classList.add(this._errorClass),this._spanError.textContent=this._inputElement.validationMessage)}toggleButton(){this._isFormValid=this._form.checkValidity(),this._buttonSubmit.disabled=!this._isFormValid,this._buttonSubmit.classList.toggle(this._buttonSubmitDisabledClass,!this._isFormValid)}}class e{constructor(t,e,o,s,i,n,{handleDelete:r}){this._cardData=t,this._photoTemplate=e,this._handleImageClick=s,this._handleLike=i,this._handleDislike=n,this._userId=o,this._handleButtonDelete=r}createCard(){return this._photoElement=this._photoTemplate.querySelector(".photo__element"),this._photoElementClone=this._photoElement.cloneNode(!0),this._cardPhoto=this._photoElementClone.querySelector(".photo__img"),this._cardPhoto.src=this._cardData.link,this._cardPhoto.alt=this._cardData.name,this._cardTitle=this._photoElementClone.querySelector(".photo__title"),this._cardTitle.textContent=this._cardData.name,this._photoDelete=this._photoElementClone.querySelector(".photo__delete"),this._userId!==this._cardData.owner._id&&this._photoDelete.classList.add("photo__delete_hidden"),this._photoLike=this._photoElementClone.querySelector(".photo__like"),this._cardData.likes.find((t=>t._id==this._userId))&&this.toggleLike(),this._photoLikeCounter=this._photoElementClone.querySelector(".photo__like-counter"),this.setLikesCount(this._cardData.likes.length),this._setEventListeners(),this._photoElementClone}_setEventListeners(){this._cardPhoto.addEventListener("click",this._handleImageClick),this._photoDelete.addEventListener("click",(()=>{this._handleButtonDelete()})),this._photoLike.addEventListener("click",(()=>{this._handleLikeClick()}))}deleteCard(){this._photoElementClone.remove()}toggleLike(){this._photoLike.classList.toggle("photo__like_active")}setLikesCount(t){this._photoLikeCounter.textContent=t}_handleLikeClick(){this._photoLike.classList.contains("photo__like_active")?this._handleDislike():this._handleLike()}}const o=document.querySelector(".popup_type_profile"),s=document.querySelector(".profile__button-edit"),i=document.querySelector(".popup__input_type_name-profile"),n=document.querySelector(".popup__input_type_profession-profile"),r=document.querySelector(".profile__name"),a=document.querySelector(".profile__subname"),h=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__button-add"),p=document.querySelector(".popup_type_place"),u=document.querySelector(".popup_type_photo"),_=(document.querySelector(".popup__img"),document.querySelector(".popup__name"),document.querySelector(".popup__form_type_place")),c=document.querySelector(".popup__form_type_profile"),d=document.querySelector("#photo-template").content,m=document.querySelector(".photo__container"),b=document.querySelector(".popup_type_avatar"),y=document.querySelector(".profile__avatar-edit"),L=document.querySelector(".popup__form_type_avatar"),f=document.querySelector(".popup_type_confirmation"),E=(document.querySelector(".popup__submit-btn_action_add-place"),document.querySelector(".popup__submit-btn_action_add-profile"),document.querySelector(".popup__submit-btn_action_edit-avatar"),{formSelector:".popup__form",inputSelector:".popup__input",errorClass:"form__input_error",buttonSubmitSelector:".popup__submit-btn",buttonSubmitDisabledClass:"popup__submit-btn_disabled"});class S{constructor(t){this._popup=t,this._btnClose=this._popup.querySelector(".btn-close")}open(){this._popup.classList.add("popup_active"),this._setEscEventListener()}close(){this._popup.classList.remove("popup_active"),this._removeEscEventListener()}_setEscEventListener(){document.addEventListener("keydown",this._handleCloseByEsc)}_removeEscEventListener(){document.removeEventListener("keydown",this._handleCloseByEsc)}setEventListeners(){this._popup.addEventListener("mousedown",this._handleCloseByOverlay),this._btnClose.addEventListener("click",(()=>{this.close()}))}_handleCloseByOverlay=t=>{t.target===t.currentTarget&&this.close()};_handleCloseByEsc=t=>{"Escape"===t.key&&this.close()}}class v extends S{constructor(t,{submitForm:e}){super(t),this._popupForm=this._popup.querySelector(".popup__form"),this._submitForm=e,this._inputList=this._popupForm.querySelectorAll(".popup__input"),this._btnSubmit=this._popup.querySelector(".popup__submit-btn")}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._handleSubmit)}_getInputValues(){return this._inputsData={},this._inputList.forEach((t=>{this._inputsData[t.name]=t.value})),this._inputsData}_handleSubmit=t=>{t.preventDefault(),this._submitForm(this._getInputValues())};close(){super.close(),this._popupForm.reset()}setSubmitButtonText(t){this._btnSubmit.textContent=t}}const g=new class{constructor(t){this._url=t.url,this._authorization=t.headers.authorization}_getResponseData(t){return t.ok?t.json():Promise.reject(`Что-то пошло не так: ${t.status}`)}getDataCards(){return fetch(`${this._url}cards`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}getDataProfile(){return fetch(`${this._url}users/me`,{method:"GET",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}patchDataProfile(t){return fetch(`${this._url}users/me`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,about:t.about})}).then((t=>this._getResponseData(t)))}patchAvatarProfile(t){return fetch(`${this._url}users/me/avatar`,{method:"PATCH",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({avatar:t.avatar})}).then((t=>this._getResponseData(t)))}postNewCard(t){return fetch(`${this._url}cards`,{method:"POST",headers:{"content-type":"application/json",authorization:this._authorization},body:JSON.stringify({name:t.name,link:t.link})}).then((t=>this._getResponseData(t)))}deleteCard(t){return fetch(`${this._url}cards/${t}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}addLikes(t){return fetch(`${this._url}cards/${t}/likes`,{method:"PUT",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}deleteLikes(t){return fetch(`${this._url}cards/${t}/likes/`,{method:"DELETE",headers:{"content-type":"application/json",authorization:this._authorization}}).then((t=>this._getResponseData(t)))}}({url:"https://mesto.nomoreparties.co/v1/cohort-62/",headers:{authorization:"b1a969d4-2380-4487-99eb-f12d66954c40"}}),k=new class{constructor(t,e,o){this._nameProfile=t,this._subNameProfile=e,this._profileAvatar=o}setUserInfo(t){this._nameProfile.textContent=t.name,this._subNameProfile.textContent=t.about,this._profileAvatar.src=t.avatar,this._idUser=t._id}getUserInfo(){return this._dataList={},this._dataList.name=this._nameProfile.textContent,this._dataList.about=this._subNameProfile.textContent,this._dataList.avatar=this._profileAvatar.src,this._dataList.id=this._idUser,this._dataList}}(r,a,h),C=new class extends S{constructor(t){super(t),this._popupForm=this._popup.querySelector(".popup__form")}setCallback(t){this._callback=t}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(t=>{t.preventDefault(),this._callback()}))}}(f);C.setEventListeners();const D=new class{constructor({renderer:t},e){this._renderer=t,this._container=e}addItem(t){this._container.prepend(t)}renderItems(t){this._renderedItems=t,this._renderedItems.forEach((t=>this._renderer(t)))}}({renderer:t=>{q(t)}},m);function q(t){D.addItem(function(t){const o=new e(t,d,k.getUserInfo().id,(()=>{B.open(t)}),(()=>{g.addLikes(t._id).then((t=>{o.toggleLike(),o.setLikesCount(t.likes.length)})).catch((t=>{console.log(t)}))}),(()=>{g.deleteLikes(t._id).then((t=>{o.toggleLike(),o.setLikesCount(t.likes.length)})).catch((t=>{console.log(t)}))}),{handleDelete:()=>{C.open(),C.setCallback((()=>{g.deleteCard(t._id).then((()=>{o.deleteCard(),C.close()})).catch((t=>{console.log(t)}))}))}});return o}(t).createCard())}Promise.all([g.getDataProfile(),g.getDataCards()]).then((t=>{k.setUserInfo(t[0]),D.renderItems(t[1].reverse())})).catch((t=>{console.log(t)}));const I=new t(E,_);I.enableValidation();const P=new t(E,c);P.enableValidation();const x=new t(E,L);x.enableValidation();const B=new class extends S{constructor(t){super(t),this._popupPhotoImg=this._popup.querySelector(".popup__img"),this._popupPhotoName=this._popup.querySelector(".popup__name")}open(t){super.open(),this._popupPhotoImg.src=t.link,this._popupPhotoName.alt=t.name,this._popupPhotoName.textContent=t.name}}(u);B.setEventListeners();const T=new v(o,{submitForm:t=>{T.setSubmitButtonText("Сохранение..."),g.patchDataProfile(t).then((t=>{k.setUserInfo(t),T.close()})).catch((t=>{console.log(t)})).finally((()=>{T.setSubmitButtonText("Сохранить")}))}});T.setEventListeners();const z=new v(b,{submitForm:t=>{z.setSubmitButtonText("Сохранение..."),g.patchAvatarProfile(t).then((t=>{k.setUserInfo(t),z.close()})).catch((t=>{console.log(t)})).finally((()=>{z.setSubmitButtonText("Сохранить")}))}});z.setEventListeners();const w=new v(p,{submitForm:t=>{w.setSubmitButtonText("Сохранение..."),g.postNewCard(t).then((t=>{q(t),w.close()})).catch((t=>{console.log(t)})).finally((()=>{w.setSubmitButtonText("Сохранить")}))}});w.setEventListeners(),y.addEventListener("click",(()=>{z.open(),x.toggleButton(),x.checkValidation()})),s.addEventListener("click",(()=>{i.value=k.getUserInfo().name,n.value=k.getUserInfo().about,T.open(),P.toggleButton(),P.checkValidation()})),l.addEventListener("click",(()=>{w.open(),I.toggleButton(),I.checkValidation()}))})();